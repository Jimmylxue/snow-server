## æ’è¡Œæ¦œç›¸å…³

### è€ƒè¯•æ¬¡æ•°æ’è¡Œæ¦œ

![image-20250404114708187](https://image.jimmyxuexue.top/img/image-20250404114708187.png)

```tsx
import React, { useEffect } from 'react';
import { Box, Text, VStack, HStack, ScrollView } from 'native-base';
import LinearGradient from 'react-native-linear-gradient';
import { StyleSheet } from 'react-native';
import { useNavigation } from '@react-navigation/native';
import { useExamRank } from '../../service/study';

// type ExamRankParams = {
//   subjectId: number;
// };

export default function CountRank() {
  const navigation = useNavigation();

  // const route = useRoute<RouteProp<Record<string, ExamRankParams>, string>>();
  // const { subjectId } = route.params;
  const { data: examRank } = useExamRank(['examRank'], {});
  console.log('examRank', examRank);

  useEffect(() => {
    navigation.setOptions({
      title: 'å†å²è€ƒè¯•æ¬¡æ•°æ’è¡Œæ¦œ',
    });
  }, [navigation]);

  return (
    <ScrollView bg="white">
      {/* é¡¶éƒ¨æ¸å˜èƒŒæ™¯ */}
      <LinearGradient
        colors={['#4c669f', '#3b5998', '#192f6a']}
        style={styles.headerGradient}>
        <VStack space={2} alignItems="center" pt={6} pb={8}>
          <Text color="white" fontSize="lg">
            ğŸ“š å†å²è€ƒè¯•æ¬¡æ•°æ’è¡Œç‰ˆ
          </Text>
          <Text color="white" fontSize="4xl" fontWeight="bold">
            {examRank?.exam_count}
          </Text>
          <Text color="white">è€ƒè¯•æ¬¡æ•°</Text>
        </VStack>
      </LinearGradient>

      {/* ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ */}
      <Box style={styles.statsCard}>
        <VStack space={4}>
          {/* è¶…è¶Šäººæ•°ç™¾åˆ†æ¯” */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <HStack justifyContent="space-between" alignItems="center">
              <Text fontSize="md">è¶…è¶Šç”¨æˆ·</Text>
              <HStack alignItems="center" space={2}>
                <Text fontSize="2xl" color="#4c669f" fontWeight="bold">
                  {examRank?.exceedPercentage}
                </Text>
                <Text fontSize="lg">ğŸƒ</Text>
              </HStack>
            </HStack>
          </Box>

          {/* ä¸ä¸Šåå·®è· */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <VStack space={2}>
              <HStack justifyContent="space-between">
                <Text fontSize="md">ä¸ä¸Šåå·®è·</Text>
                <HStack alignItems="center" space={2}>
                  <Text fontSize="xl" color="#4c669f" fontWeight="bold">
                    {examRank?.gapWithPrev}
                  </Text>
                  <Text fontSize="lg">â¬†ï¸</Text>
                </HStack>
              </HStack>
              <Text fontSize="sm" color="gray.500">
                ä¸Šåæˆç»©ï¼š{examRank?.prevUserExamCount}æ¬¡
              </Text>
            </VStack>
          </Box>

          {/* ä¸ç¬¬ä¸€åå·®è· */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <VStack space={2}>
              <HStack justifyContent="space-between">
                <Text fontSize="md">è·ç¦»ç¬¬ä¸€å</Text>
                <HStack alignItems="center" space={2}>
                  <Text fontSize="xl" color="#4c669f" fontWeight="bold">
                    {examRank?.gapWithFirst}
                  </Text>
                  <Text fontSize="lg">ğŸ‘‘</Text>
                </HStack>
              </HStack>
              <Text fontSize="sm" color="gray.500">
                ç¬¬ä¸€åè€ƒè¯•æ¬¡æ•°ï¼š{examRank?.firstUserCount}åˆ†
              </Text>
            </VStack>
          </Box>

          {/* å½“å‰æ’å */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <HStack justifyContent="space-between" alignItems="center">
              <Text fontSize="md">å½“å‰æ’å</Text>
              <HStack alignItems="center" space={2}>
                <Text fontSize="2xl" color="#4c669f" fontWeight="bold">
                  {examRank?.rank}
                </Text>
                <Text fontSize="lg">ğŸ†</Text>
              </HStack>
            </HStack>
          </Box>
        </VStack>
      </Box>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  headerGradient: {
    minHeight: 200,
    borderBottomLeftRadius: 30,
    borderBottomRightRadius: 30,
  },
  statsCard: {
    marginTop: -30,
    marginHorizontal: 16,
    padding: 16,
    borderRadius: 20,
    backgroundColor: 'rgba(246,246,246,0.9)',
  },
});

```

### è‡ªä¹ å­¦ä¹ æ—¶é—´æ’è¡Œæ¦œ

![image-20250404114812049](https://image.jimmyxuexue.top/img/image-20250404114812049.png)

```ts
import React, { useEffect } from 'react';
import { Box, Text, VStack, HStack, ScrollView } from 'native-base';
import LinearGradient from 'react-native-linear-gradient';
import { StyleSheet } from 'react-native';
import { useNavigation } from '@react-navigation/native';
import { useStudyRoomStatus } from '../../service/study';
export default function StudyRank() {
  const navigation = useNavigation();

  const { data: studyRoomStatus } = useStudyRoomStatus(['studyRoomStatus'], {});

  useEffect(() => {
    navigation.setOptions({
      title: 'è‡ªä¹ æ’è¡Œæ¦œ',
    });
  }, [navigation]);

  return (
    <ScrollView bg="white">
      {/* é¡¶éƒ¨æ¸å˜èƒŒæ™¯ */}
      <LinearGradient
        colors={['#4c669f', '#3b5998', '#192f6a']}
        style={styles.headerGradient}>
        <VStack space={2} alignItems="center" pt={6} pb={8}>
          <Text color="white" fontSize="lg">
            ğŸ“š è‡ªä¹ å®¤å­¦ä¹ æ—¶é•¿æ’è¡Œ
          </Text>
          <Text color="white" fontSize="4xl" fontWeight="bold">
            {studyRoomStatus?.studyTime || 0}
          </Text>
          <Text color="white">æ€»å­¦ä¹ æ—¶é—´</Text>
        </VStack>
      </LinearGradient>

      {/* ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ */}
      <Box style={styles.statsCard}>
        <VStack space={4}>
          {/* è¶…è¶Šäººæ•°ç™¾åˆ†æ¯” */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <HStack justifyContent="space-between" alignItems="center">
              <Text fontSize="md">è¶…è¶Šç”¨æˆ·</Text>
              <HStack alignItems="center" space={2}>
                <Text fontSize="2xl" color="#4c669f" fontWeight="bold">
                  {studyRoomStatus?.exceedPercentage}
                </Text>
                <Text fontSize="lg">ğŸƒ</Text>
              </HStack>
            </HStack>
          </Box>

          {/* ä¸ä¸Šåå·®è· */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <VStack space={2}>
              <HStack justifyContent="space-between">
                <Text fontSize="md">ä¸ä¸Šåå·®è·</Text>
                <HStack alignItems="center" space={2}>
                  <Text fontSize="xl" color="#4c669f" fontWeight="bold">
                    {studyRoomStatus?.gapWithPrev}åˆ†é’Ÿ
                  </Text>
                  <Text fontSize="lg">â¬†ï¸</Text>
                </HStack>
              </HStack>
              <Text fontSize="sm" color="gray.500">
                ä¸Šåæˆç»©ï¼š{studyRoomStatus?.prevUserStudyTime}åˆ†
              </Text>
            </VStack>
          </Box>

          {/* ä¸ç¬¬ä¸€åå·®è· */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <VStack space={2}>
              <HStack justifyContent="space-between">
                <Text fontSize="md">è·ç¦»ç¬¬ä¸€å</Text>
                <HStack alignItems="center" space={2}>
                  <Text fontSize="xl" color="#4c669f" fontWeight="bold">
                    {studyRoomStatus?.gapWithFirst}åˆ†é’Ÿ
                  </Text>
                  <Text fontSize="lg">ğŸ‘‘</Text>
                </HStack>
              </HStack>
              <Text fontSize="sm" color="gray.500">
                ç¬¬ä¸€åå­¦ä¹ æ—¶é—´ï¼š{studyRoomStatus?.firstUserStudyTime}åˆ†é’Ÿ
              </Text>
            </VStack>
          </Box>

          {/* å½“å‰æ’å */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <HStack justifyContent="space-between" alignItems="center">
              <Text fontSize="md">å½“å‰æ’å</Text>
              <HStack alignItems="center" space={2}>
                <Text fontSize="2xl" color="#4c669f" fontWeight="bold">
                  {studyRoomStatus?.rank}
                </Text>
                <Text fontSize="lg">ğŸ†</Text>
              </HStack>
            </HStack>
          </Box>
        </VStack>
      </Box>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  headerGradient: {
    minHeight: 200,
    borderBottomLeftRadius: 30,
    borderBottomRightRadius: 30,
  },
  statsCard: {
    marginTop: -30,
    marginHorizontal: 16,
    padding: 16,
    borderRadius: 20,
    backgroundColor: 'rgba(246,246,246,0.9)',
  },
});

```



### ç§‘ç›®è€ƒè¯•æ’è¡Œæ¦œ

![image-20250404114949267](https://image.jimmyxuexue.top/img/image-20250404114949267.png)

```tsx
import React, { useEffect } from 'react';
import { Box, Text, VStack, HStack, ScrollView } from 'native-base';
import LinearGradient from 'react-native-linear-gradient';
import { StyleSheet } from 'react-native';
import { RouteProp, useNavigation, useRoute } from '@react-navigation/native';
import { useExamScoreRank } from '../../service/study';

type ExamRankParams = {
  subjectId: number;
};

export default function ExamRank() {
  const navigation = useNavigation();

  const route = useRoute<RouteProp<Record<string, ExamRankParams>, string>>();
  const { subjectId } = route.params;
  const { data: examScoreRank } = useExamScoreRank(
    ['examScoreRank', subjectId],
    { examProjectId: +subjectId },
  );

  console.log('examScoreRank', examScoreRank);
  const examInfo = {
    subject: '2024å¹´çœŸé¢˜ä¸€æ¬¡æ¨¡æ‹Ÿè¯•å·',
    highestScore: 95,
    totalStudents: 1000,
    currentRank: 56,
    nextScore: 96,
    topScore: 100,
    percentage: 94.4, // è¶…è¶Šçš„ç™¾åˆ†æ¯”
  };

  useEffect(() => {
    navigation.setOptions({
      title: 'æ•°å­¦æ’è¡Œæ¦œ',
    });
  }, [navigation]);

  return (
    <ScrollView bg="white">
      {/* é¡¶éƒ¨æ¸å˜èƒŒæ™¯ */}
      <LinearGradient
        colors={['#4c669f', '#3b5998', '#192f6a']}
        style={styles.headerGradient}>
        <VStack space={2} alignItems="center" pt={6} pb={8}>
          <Text color="white" fontSize="lg">
            ğŸ“š {examInfo.subject}
          </Text>
          <Text color="white" fontSize="4xl" fontWeight="bold">
            {examScoreRank?.bestScore}
          </Text>
          <Text color="white">å†å²æœ€é«˜åˆ†</Text>
        </VStack>
      </LinearGradient>

      {/* ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ */}
      <Box style={styles.statsCard}>
        <VStack space={4}>
          {/* è¶…è¶Šäººæ•°ç™¾åˆ†æ¯” */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <HStack justifyContent="space-between" alignItems="center">
              <Text fontSize="md">è¶…è¶Šç”¨æˆ·</Text>
              <HStack alignItems="center" space={2}>
                <Text fontSize="2xl" color="#4c669f" fontWeight="bold">
                  {examScoreRank?.beatPercentage}%
                </Text>
                <Text fontSize="lg">ğŸƒ</Text>
              </HStack>
            </HStack>
          </Box>

          {/* ä¸ä¸Šåå·®è· */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <VStack space={2}>
              <HStack justifyContent="space-between">
                <Text fontSize="md">ä¸ä¸Šåå·®è·</Text>
                <HStack alignItems="center" space={2}>
                  <Text fontSize="xl" color="#4c669f" fontWeight="bold">
                    {examScoreRank?.gapToPrev}
                  </Text>
                  <Text fontSize="lg">â¬†ï¸</Text>
                </HStack>
              </HStack>
              <Text fontSize="sm" color="gray.500">
                ä¸Šåæˆç»©ï¼š{examScoreRank?.prevRankScore}åˆ†
              </Text>
            </VStack>
          </Box>

          {/* ä¸ç¬¬ä¸€åå·®è· */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <VStack space={2}>
              <HStack justifyContent="space-between">
                <Text fontSize="md">è·ç¦»ç¬¬ä¸€å</Text>
                <HStack alignItems="center" space={2}>
                  <Text fontSize="xl" color="#4c669f" fontWeight="bold">
                    {examScoreRank?.gapToFirst}
                  </Text>
                  <Text fontSize="lg">ğŸ‘‘</Text>
                </HStack>
              </HStack>
              <Text fontSize="sm" color="gray.500">
                ç¬¬ä¸€åæˆç»©ï¼š{examScoreRank?.firstScore}åˆ†
              </Text>
            </VStack>
          </Box>

          {/* å½“å‰æ’å */}
          <Box bg="rgba(255,255,255,0.9)" p={4} rounded="lg" shadow={2}>
            <HStack justifyContent="space-between" alignItems="center">
              <Text fontSize="md">å½“å‰æ’å</Text>
              <HStack alignItems="center" space={2}>
                <Text fontSize="2xl" color="#4c669f" fontWeight="bold">
                  {examScoreRank?.rank}
                </Text>
                <Text fontSize="lg">ğŸ†</Text>
              </HStack>
            </HStack>
          </Box>
        </VStack>
      </Box>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  headerGradient: {
    minHeight: 200,
    borderBottomLeftRadius: 30,
    borderBottomRightRadius: 30,
  },
  statsCard: {
    marginTop: -30,
    marginHorizontal: 16,
    padding: 16,
    borderRadius: 20,
    backgroundColor: 'rgba(246,246,246,0.9)',
  },
});
```

### ç®¡åº“å‘˜é¡µé¢

![image-20250404115401806](https://image.jimmyxuexue.top/img/image-20250404115401806.png)

![image-20250404115418064](https://image.jimmyxuexue.top/img/image-20250404115418064.png)

```tsx
import {
  Button,
  CheckIcon,
  FormControl,
  Input,
  Select,
  TextArea,
  Toast,
  View,
} from 'native-base';
import React, { SafeAreaView } from 'react-native';
import { useState } from 'react';
import { adaptive } from '../../utils';
import { EExamType, useExamType, useAddExam } from '../../service/exam';

export function UploadExam() {
  const [typeId, setTypeId] = useState<string>('');
  const [name, setName] = useState<string>('');
  const [desc, setDesc] = useState<string>('');
  const [examType, setExamType] = useState<string>('');
  const [option, setOption] = useState<string>('');
  const [answer, setAnswer] = useState<string>('');
  const { data } = useExamType(['examType'], {}, {});
  // console.log('data', data);

  const { mutateAsync } = useAddExam({
    onSuccess: () => {
      Toast.show({ title: 'æ·»åŠ æˆåŠŸ' });
      setTypeId('');
      setName('');
      setDesc('');
      setExamType('');
      setOption('');
      setAnswer('');
    },
    onError: error => {
      Toast.show({ title: 'æ·»åŠ å¤±è´¥' });
      console.log('error', error);
    },
  });

  return (
    <SafeAreaView>
      <View
        px={2}
        style={{
          paddingTop: adaptive(280),
        }}>
        <FormControl>
          <FormControl.Label>{'é¢˜ç›®åç§°'}</FormControl.Label>
          <Input
            placeholder={'è¯·è¾“å…¥é¢˜ç›®åç§°'}
            w="100%"
            value={name}
            onChangeText={val => setName(val)}
          />
        </FormControl>
        <FormControl>
          <FormControl.Label>{'é¢˜ç›®æè¿°'}</FormControl.Label>
          <Input
            placeholder={'è¯·è¾“å…¥é¢˜ç›®æè¿°'}
            w="100%"
            value={desc}
            onChangeText={val => setDesc(val)}
          />
        </FormControl>
        <FormControl>
          <FormControl.Label>{'é¢˜ç›®ç±»å‹'}</FormControl.Label>
          <Select
            selectedValue={typeId}
            minWidth="200"
            accessibilityLabel="é€‰æ‹©è¯¾ç¨‹ç±»å‹"
            placeholder="Choose Service"
            _selectedItem={{
              bg: 'teal.600',
              endIcon: <CheckIcon size="5" />,
            }}
            mt={1}
            onValueChange={itemValue => {
              console.log('itemValue', itemValue);
              setTypeId(itemValue);
            }}>
            {data?.map(type => (
              <Select.Item
                key={type.id}
                label={type.name}
                value={String(type.id)}
              />
            ))}
          </Select>
        </FormControl>

        <FormControl>
          <FormControl.Label>{'è€ƒé¢˜æ–¹å¼'}</FormControl.Label>
          <Select
            selectedValue={examType}
            minWidth="200"
            accessibilityLabel="é€‰æ‹©è¯¾ç¨‹ç±»å‹"
            placeholder="Choose Service"
            _selectedItem={{
              bg: 'teal.600',
              endIcon: <CheckIcon size="5" />,
            }}
            mt={1}
            onValueChange={itemValue => setExamType(itemValue)}>
            <Select.Item label={'é€‰æ‹©é¢˜'} value={'1'} />
            <Select.Item label={'åˆ¤æ–­é¢˜'} value={'2'} />
          </Select>
        </FormControl>

        {+examType === EExamType.é€‰æ‹©é¢˜ && (
          <FormControl>
            <FormControl.Label>{'é¢˜ç›®é€‰é¡¹'}</FormControl.Label>
            {/* @ts-ignore */}
            <TextArea
              aria-label="t1"
              numberOfLines={4}
              placeholder={'è¯·è¾“å…¥é¢˜ç›®é€‰é¡¹ï¼Œä»¥@éš”å¼€'}
              // isInvalid
              _dark={{
                placeholderTextColor: 'gray.300',
              }}
              mb="5"
              value={option}
              onChangeText={val => setOption(val)}
            />
          </FormControl>
        )}

        <FormControl>
          <FormControl.Label>{'æ ‡å‡†ç­”æ¡ˆ'}</FormControl.Label>
          <Input
            placeholder={'è¯·è¾“å…¥æ•°å­—ï¼Œä»£è¡¨æ­£ç¡®ç­”æ¡ˆæ˜¯ç¬¬å‡ é¡¹ï¼Œåˆ¤æ–­é¢˜åªèƒ½è¾“å…¥1æˆ–2'}
            w="100%"
            value={answer}
            onChangeText={val => setAnswer(val)}
          />
        </FormControl>

        <Button
          onPress={async () => {
            const isXuanZe = Number(examType) === EExamType.é€‰æ‹©é¢˜;
            if (!isXuanZe) {
              // åˆ¤æ–­é¢˜
              if (!['1', '2'].includes(answer)) {
                Toast.show({ title: 'åˆ¤æ–­é¢˜è¶…è¿‡èŒƒå›´' });
                return;
              }
            }
            console.log('examType', examType);
            console.log('option', option, typeId);
            const params = {
              name,
              desc,
              typeId: Number(typeId),
              examType: Number(examType),
              option: isXuanZe ? option : 'å¯¹@é”™',
              answer: answer,
            };
            await mutateAsync(params);
          }}
          mt={2}>
          ä¸Šä¼ é¢˜ç›®
        </Button>
      </View>
    </SafeAreaView>
  );
}
```

## æ•°æ®åº“è¡¨ç›¸å…³æ”¹åŠ¨

```ts
@Entity('examRecord', { schema: 'snow-server' })
export class ExamRecord {
  @PrimaryGeneratedColumn({ type: 'int', name: 'id', comment: 'è€ƒè¯•è®°å½•id' })
  id: number;

  @Column('int', { name: 'userId', comment: 'ç”¨æˆ·id' })
  userId: number;

  @ManyToOne(() => User, (user) => user.id, {
    onDelete: 'CASCADE',
  })
  @JoinColumn({ name: 'userId' })
  user: number;

  @ManyToOne(() => ExamProject, (examProject) => examProject.id, {
    onDelete: 'CASCADE',
  })
  @JoinColumn({ name: 'examProjectId' })
  examProject: number;

  @Column('int', { name: 'examProjectId', comment: 'è€ƒè¯•é¡¹ç›®id' })
  examProjectId: number;

  @Column('text', { name: 'desc', comment: 'è€ƒè¯•å¿ƒå¾—' })
  desc: string;

  @Column('int', { name: 'useTime', comment: 'è€ƒè¯•ç”¨æ—¶' })
  useTime: number;

  @Column('int', { name: 'remainTime', comment: 'å‰©ä½™æ—¶é—´' })
  remainTime: number;

  @Column('int', { name: 'overTime', comment: 'è¶…æ—¶æ—¶é—´' })
  overTime: number;

  @Column('int', { name: 'totalScore', comment: 'æ€»å¾—åˆ†' })
  totalScore: number;

  @Column('text', { name: 'paperDesc', comment: 'è¯•å·åç§°' })
  paperText: string;

  @CreateDateColumn({ comment: 'åˆ›å»ºæ—¶é—´', type: 'timestamp' })
  createdTime: Date;

  @UpdateDateColumn({ comment: 'æ›´æ–°æ—¶é—´', type: 'timestamp' })
  updateTime: Date;
}
```

